<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitShare - Expense Sharing App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">SplitShare</h1>
            <p class="text-slate-500 mt-2">Fairly split expenses with friends and family.</p>
        </header>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

            <!-- Left Column: Members & Balances -->
            <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Group Members</h2>
                    <button id="add-person-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors shadow-sm">
                        Add Person
                    </button>
                </div>
                <div id="members-list" class="space-y-3">
                    <!-- Member items will be dynamically inserted here -->
                </div>
            </div>

            <!-- Right Column: Expenses & Summary -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Expenses Section -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-semibold">Expenses</h2>
                        <button id="add-expense-btn" class="bg-teal-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-teal-600 transition-colors shadow-sm">
                            Add Expense
                        </button>
                    </div>
                    <div id="expenses-list" class="space-y-4 max-h-[300px] overflow-y-auto pr-2">
                        <!-- Expense items will be dynamically inserted here -->
                    </div>
                     <div id="no-expenses-placeholder" class="text-center py-8 text-slate-500 hidden">
                        <p>No expenses added yet.</p>
                        <p>Click "Add Expense" to get started!</p>
                    </div>
                </div>

                <!-- Summary Section -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-semibold mb-4">How to Settle Up</h2>
                    <div id="summary-list" class="space-y-3">
                        <!-- Summary items will be dynamically inserted here -->
                    </div>
                    <div id="all-settled-placeholder" class="text-center py-8 text-slate-500 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-green-500" viewBox="0 0 20 20" fill="currentColor">
                           <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        <p class="mt-2 text-lg font-medium">All settled up!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Person Modal -->
    <div id="add-person-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 invisible opacity-0">
        <div class="modal-content bg-white w-full max-w-md p-6 rounded-2xl shadow-2xl transform scale-95">
            <h3 class="text-2xl font-semibold mb-4">Add a New Person</h3>
            <form id="add-person-form">
                <label for="person-name" class="block text-sm font-medium text-slate-700">Name</label>
                <input type="text" id="person-name" placeholder="e.g., Jane Doe" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" class="modal-close-btn px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 transition-colors">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div id="add-expense-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 invisible opacity-0">
        <div class="modal-content bg-white w-full max-w-lg p-6 rounded-2xl shadow-2xl transform scale-95">
            <h3 class="text-2xl font-semibold mb-6">Add an Expense</h3>
            <form id="add-expense-form">
                <!-- Description -->
                <div class="mb-4">
                    <label for="expense-description" class="block text-sm font-medium text-slate-700">Description</label>
                    <input type="text" id="expense-description" placeholder="e.g., Dinner, Groceries" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                </div>
                <!-- Amount -->
                <div class="mb-4">
                    <label for="expense-amount" class="block text-sm font-medium text-slate-700">Amount ($)</label>
                    <input type="number" id="expense-amount" placeholder="0.00" min="0.01" step="0.01" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                </div>
                <!-- Paid By -->
                <div class="mb-4">
                    <label for="expense-paid-by" class="block text-sm font-medium text-slate-700">Paid by</label>
                    <select id="expense-paid-by" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <!-- Split With -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-700">Split between</label>
                    <div id="expense-split-with" class="mt-2 space-y-2 max-h-32 overflow-y-auto border border-slate-300 rounded-lg p-3">
                        <!-- Checkboxes populated by JS -->
                    </div>
                </div>

                <div class="flex justify-end gap-3">
                    <button type="button" class="modal-close-btn px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 transition-colors">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 transition-colors">Add</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const membersList = document.getElementById('members-list');
            const expensesList = document.getElementById('expenses-list');
            const summaryList = document.getElementById('summary-list');
            const noExpensesPlaceholder = document.getElementById('no-expenses-placeholder');
            const allSettledPlaceholder = document.getElementById('all-settled-placeholder');

            // Modals
            const addPersonModal = document.getElementById('add-person-modal');
            const addExpenseModal = document.getElementById('add-expense-modal');
            const addPersonForm = document.getElementById('add-person-form');
            const addExpenseForm = document.getElementById('add-expense-form');
            const personNameInput = document.getElementById('person-name');

            // Modal Controls
            const addPersonBtn = document.getElementById('add-person-btn');
            const addExpenseBtn = document.getElementById('add-expense-btn');
            const modalCloseBtns = document.querySelectorAll('.modal-close-btn');

            // App State
            let members = [
                { id: 1, name: 'Alice' },
                { id: 2, name: 'Bob' },
                { id: 3, name: 'Charlie' },
            ];
            let expenses = [
                { id: 1, description: 'Dinner', amount: 90, paidById: 1, splitWithIds: [1, 2, 3] },
                { id: 2, description: 'Movie Tickets', amount: 45, paidById: 2, splitWithIds: [1, 2, 3] },
                { id: 3, description: 'Groceries', amount: 60, paidById: 3, splitWithIds: [2, 3] },
            ];
            let nextMemberId = 4;
            let nextExpenseId = 4;
            
            // --- MODAL VISIBILITY ---
            const openModal = (modal) => {
                modal.classList.remove('invisible', 'opacity-0');
                modal.querySelector('.modal-content').classList.remove('scale-95');
                modal.querySelector('.modal-content').classList.add('scale-100');
            };

            const closeModal = (modal) => {
                modal.classList.add('opacity-0');
                modal.querySelector('.modal-content').classList.remove('scale-100');
                modal.querySelector('.modal-content').classList.add('scale-95');
                setTimeout(() => modal.classList.add('invisible'), 300);
            };

            addPersonBtn.addEventListener('click', () => openModal(addPersonModal));
            addExpenseBtn.addEventListener('click', () => {
                if (members.length < 2) {
                    alert("You need at least two people in the group to add an expense.");
                    return;
                }
                populateExpenseModal();
                openModal(addExpenseModal);
            });
            modalCloseBtns.forEach(btn => btn.addEventListener('click', () => {
                closeModal(addPersonModal);
                closeModal(addExpenseModal);
            }));

            // --- DATA HANDLING ---
            addPersonForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = personNameInput.value.trim();
                if (name) {
                    members.push({ id: nextMemberId++, name });
                    personNameInput.value = '';
                    closeModal(addPersonModal);
                    render();
                }
            });

            addExpenseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const description = document.getElementById('expense-description').value.trim();
                const amount = parseFloat(document.getElementById('expense-amount').value);
                const paidById = parseInt(document.getElementById('expense-paid-by').value);
                const splitWithIds = Array.from(document.querySelectorAll('#expense-split-with input:checked')).map(el => parseInt(el.value));

                if (description && amount > 0 && paidById && splitWithIds.length > 0) {
                    expenses.push({ id: nextExpenseId++, description, amount, paidById, splitWithIds });
                    addExpenseForm.reset();
                    closeModal(addExpenseModal);
                    render();
                } else {
                    alert('Please fill out all fields and select at least one person to split with.');
                }
            });

            const deleteMember = (id) => {
                 if (!confirm('Are you sure you want to remove this person? This will also remove all expenses they are part of.')) return;
                 
                 members = members.filter(member => member.id !== id);
                 expenses = expenses.filter(expense => {
                    return expense.paidById !== id && !expense.splitWithIds.includes(id);
                 });
                 render();
            }
            
            const deleteExpense = (id) => {
                 if (!confirm('Are you sure you want to delete this expense?')) return;
                 expenses = expenses.filter(expense => expense.id !== id);
                 render();
            }
            
            window.deleteMember = deleteMember;
            window.deleteExpense = deleteExpense;

            // --- CALCULATIONS ---
            const calculateBalances = () => {
                const balances = new Map(members.map(m => [m.id, 0]));

                expenses.forEach(expense => {
                    const payerId = expense.paidById;
                    const amount = expense.amount;
                    const splitCount = expense.splitWithIds.length;
                    const share = amount / splitCount;

                    // Payer gets credit
                    balances.set(payerId, balances.get(payerId) + amount);

                    // Splitters get debt
                    expense.splitWithIds.forEach(memberId => {
                        balances.set(memberId, balances.get(memberId) - share);
                    });
                });
                return balances;
            };

            const calculateSettlements = (balances) => {
                const payers = [];
                const owers = [];

                balances.forEach((balance, id) => {
                    if (balance > 0.01) payers.push({ id, amount: balance });
                    if (balance < -0.01) owers.push({ id, amount: -balance });
                });

                payers.sort((a, b) => b.amount - a.amount);
                owers.sort((a, b) => b.amount - a.amount);

                const settlements = [];
                let i = 0, j = 0;

                while (i < payers.length && j < owers.length) {
                    const payer = payers[i];
                    const ower = owers[j];
                    const amount = Math.min(payer.amount, ower.amount);

                    settlements.push({
                        from: ower.id,
                        to: payer.id,
                        amount: amount
                    });

                    payer.amount -= amount;
                    ower.amount -= amount;

                    if (payer.amount < 0.01) i++;
                    if (ower.amount < 0.01) j++;
                }
                return settlements;
            };

            // --- RENDERING ---
            const renderMembers = (balances) => {
                membersList.innerHTML = '';
                if (members.length === 0) {
                     membersList.innerHTML = `<p class="text-slate-500 text-center py-4">No members yet. Add one to get started!</p>`;
                     return;
                }
                
                members.forEach(member => {
                    const balance = balances.get(member.id) || 0;
                    const balanceColor = balance > 0.01 ? 'text-green-600' : (balance < -0.01 ? 'text-red-600' : 'text-slate-500');
                    const balanceText = balance > 0.01 ? `is owed $${balance.toFixed(2)}` : (balance < -0.01 ? `owes $${(-balance).toFixed(2)}` : 'is settled up');
                    
                    const memberEl = document.createElement('div');
                    memberEl.className = 'flex justify-between items-center bg-slate-100 p-3 rounded-lg';
                    memberEl.innerHTML = `
                        <div>
                            <p class="font-semibold">${member.name}</p>
                            <p class="text-sm ${balanceColor}">${balanceText}</p>
                        </div>
                        <button onclick="deleteMember(${member.id})" class="text-slate-400 hover:text-red-500 transition-colors p-1 rounded-full">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                        </button>
                    `;
                    membersList.appendChild(memberEl);
                });
            };

            const renderExpenses = () => {
                expensesList.innerHTML = '';
                if (expenses.length === 0) {
                    noExpensesPlaceholder.classList.remove('hidden');
                    return;
                }
                noExpensesPlaceholder.classList.add('hidden');

                [...expenses].reverse().forEach(expense => {
                    const payer = members.find(m => m.id === expense.paidById);
                    if (!payer) return;

                    const splitCount = expense.splitWithIds.length;
                    const share = (expense.amount / splitCount).toFixed(2);
                    
                    const expenseEl = document.createElement('div');
                    expenseEl.className = 'border border-slate-200 p-4 rounded-lg';
                    expenseEl.innerHTML = `
                        <div class="flex justify-between items-start">
                           <div>
                              <p class="font-semibold text-lg">${expense.description}</p>
                              <p class="text-slate-500 text-sm">${payer.name} paid $${expense.amount.toFixed(2)}</p>
                              <p class="text-slate-500 text-sm mt-1">Split between ${splitCount} people ($${share} each)</p>
                           </div>
                           <button onclick="deleteExpense(${expense.id})" class="text-slate-400 hover:text-red-500 transition-colors p-1 rounded-full flex-shrink-0">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                           </button>
                        </div>
                    `;
                    expensesList.appendChild(expenseEl);
                });
            };
            
            const renderSummary = (settlements) => {
                summaryList.innerHTML = '';
                if (settlements.length === 0) {
                    allSettledPlaceholder.classList.remove('hidden');
                    return;
                }
                allSettledPlaceholder.classList.add('hidden');

                settlements.forEach(settlement => {
                    const from = members.find(m => m.id === settlement.from);
                    const to = members.find(m => m.id === settlement.to);
                     if (!from || !to) return;
                     
                    const summaryEl = document.createElement('div');
                    summaryEl.className = 'flex items-center justify-between bg-slate-100 p-3 rounded-lg';
                    summaryEl.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="font-semibold text-indigo-600">${from.name}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" viewBox="0 0 20 20" fill="currentColor">
                               <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            <span class="font-semibold text-teal-600">${to.name}</span>
                        </div>
                        <span class="font-bold text-slate-800">$${settlement.amount.toFixed(2)}</span>
                    `;
                    summaryList.appendChild(summaryEl);
                });
            };
            
            const populateExpenseModal = () => {
                const paidBySelect = document.getElementById('expense-paid-by');
                const splitWithContainer = document.getElementById('expense-split-with');
                paidBySelect.innerHTML = '';
                splitWithContainer.innerHTML = '';

                members.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = member.name;
                    paidBySelect.appendChild(option);

                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'flex items-center';
                    checkboxDiv.innerHTML = `
                        <input id="split-${member.id}" name="split-with" type="checkbox" value="${member.id}" checked class="h-4 w-4 text-teal-600 border-slate-300 rounded focus:ring-teal-500">
                        <label for="split-${member.id}" class="ml-2 block text-sm text-slate-900">${member.name}</label>
                    `;
                    splitWithContainer.appendChild(checkboxDiv);
                });
            }

            // --- Initial Render ---
            const render = () => {
                const balances = calculateBalances();
                const settlements = calculateSettlements(balances);
                
                renderMembers(balances);
                renderExpenses();
                renderSummary(settlements);
            };

            render();
        });
    </script>
</body>
</html>
